<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper
	namespace="com.dian.mmall.dao.releaseDao.MenuAndRenovationAndPestControlMapper">

	<!--发布过的条数 -->
	<select id="countNum" resultType="int">
		select count(*) from
		menuandrenovationandpestcontrol where welfareStatus!=3
		and
		releaseType=#{releaseType} and userId =#{userId}
	</select>
	<!--发布过的条数 -->
	<select id="getreleaseType" resultType="int">
		select releaseType from
		menuandrenovationandpestcontrol where id =#{id}
	</select>


	<!--创建用户成功返回非0 -->
	<insert id="create_menuAndRenovationAndPestControl">
		insert into menuandrenovationandpestcontrol (
		userId,releaseType,updateTime,createTime,pictureUrl,
		consigneeName,userType,serviceDetailed,
		startPrice,remarks,termOfValidity,
		serviceIntroduction,releaseTitle,authentiCationStatus,welfareStatus
		)
		values (
		#{userId}, #{releaseType}, #{updateTime},
		#{createTime},#{pictureUrl},
		#{consigneeName},#{userType},
		#{serviceDetailed},#{startPrice},
		#{remarks},#{termOfValidity},#{serviceIntroduction},
		#{releaseTitle},#{authentiCationStatus},#{welfareStatus}
		)
	</insert><!-- countNum -->

	<!--用户查询分页总条数 -->
	<select id="get_usermrp_list_no" resultType="long">
		select count(*) from menuandrenovationandpestcontrol where
		welfareStatus!=3 and userId=#{userId}
		<if test="welfareStatus!=null">and welfareStatus=#{welfareStatus}   </if>
		<if test="releaseType!=null">and releaseType=#{releaseType}   </if>
	</select>

	<!--用户查询分页 -->
	<select id="get_usermpr_list_all"
		resultType="com.dian.mmall.pojo.meichongguanggao.MenuAndRenovationAndPestControl">
		select id,userId,evaluateid,servicFrequenc,releaseType,
		releaseTitle,serviceIntroduction,remarks,pictureUrl,startPrice,
		welfareStatus,authentiCationStatus,authentiCationFailure,
		consigneeName,createTime,termOfValidity,
		updateTime,serviceDetailed
		from menuandrenovationandpestcontrol
		where welfareStatus!=3 and
		userId=#{userId}
		<if test="welfareStatus!=null">and welfareStatus=#{welfareStatus}   </if>
		<if test="releaseType!=null">and releaseType=#{releaseType}   </if>
		order by updateTime desc
		limit #{pageLength}, #{pageSize}
	</select>





	<!-- 审核分页总条数 -->
	<select id="get_mrp_list_no" resultType="long">
		select count(*) from menuandrenovationandpestcontrol where
		authentiCationStatus in(1,3)
		<if test="contact!=null and contact.trim()!=''">and userId in (select
			userId from t_user_realname where
			contact=#{contact} )
		</if>
		<if test="releaseType!=null">and releaseType=#{releaseType}   </if>
	</select>
	<!-- 审核分页 -->

	<select id="get_mpr_list_all"
		resultType="com.dian.mmall.pojo.meichongguanggao.MenuAndRenovationAndPestControl">
		select id,userId,evaluateid,servicFrequenc,releaseType,
		releaseTitle,serviceIntroduction,remarks,pictureUrl,startPrice,
		welfareStatus,authentiCationStatus,authentiCationFailure,
		consigneeName,createTime,termOfValidity,
		updateTime,serviceDetailed,examineName,examineTime,userType
		from
		menuandrenovationandpestcontrol
		where authentiCationStatus in(1,3)
		<if test="contact!=null and contact.trim()!=''">and userId in (select
			userId from t_user_realname where
			contact=#{contact} )
		</if>
		<if test="releaseType!=null">and releaseType=#{releaseType}   </if>
		order by createTime
		limit #{pageLength}, #{pageSize}
	</select>

	<!-- 审核 -->

	<update id="examineMrp">
		update menuandrenovationandpestcontrol set
		authentiCationStatus=#{authentiCationStatus},authentiCationFailure=#{authentiCationFailure},examineTime=#{examineTime},examineName=#{examineName},
		welfareStatus=#{welfareStatus}
		where userId=#{userId} and id=#{id}
	</update>


	<!-- 刷新，隐藏等操作 -->
	<update id="operation_usermrp">
		update menuandrenovationandpestcontrol set
		<if test="type==1 "> updateTime=#{timeString} ,
			termOfValidity=#{termOfValidity} </if>
		<if test="type==3 "> welfareStatus=2,updateTime=#{timeString}</if>
		<if test="type==4 "> welfareStatus=1,updateTime=#{timeString},
			termOfValidity=#{termOfValidity}</if>
		<if test="type==5 "> welfareStatus=3,updateTime=#{timeString}</if>
		
		<if test="type==2 "> updateTime=#{timeString} ,
			termOfValidity=#{termOfValidity} ,welfareStatus=1
		</if>
		
		<if test="type==7 ">welfareStatus=5,updateTime=#{timeString},examineName='过期定时任务'
		</if>
		<if test="type==8 ">welfareStatus=3,updateTime=#{timeString},examineName='删除定时任务'
		</if>
		where userId=#{userId} and id=#{id}
		<if test="type==4 "> and welfareStatus not in(4,3)</if>
		<if test="type==2 or type==8"> and welfareStatus=5 and authentiCationStatus=2</if>
	</update>

	<!-- 用户根据id查询自己发布的 -->
	<select id="get_usermrp_id"
		resultType="com.dian.mmall.pojo.meichongguanggao.MenuAndRenovationAndPestControl">
		select id,userId,releaseType,
		releaseTitle,serviceIntroduction,remarks,pictureUrl,startPrice,
		consigneeName,serviceDetailed,
		welfareStatus,authentiCationStatus,authentiCationFailure,createTime,termOfValidity
		from menuandrenovationandpestcontrol
		where welfareStatus!=3 and
		userId=#{userId} and id=#{id}
	</select>

	<!-- 用户编辑 -->
	<update id="update_menuAndRenovationAndPestControl">
		update menuandrenovationandpestcontrol set
		releaseTitle=#{releaseTitle},serviceIntroduction=#{serviceIntroduction},
		remarks=#{remarks},pictureUrl=#{pictureUrl},startPrice=#{startPrice},
		serviceDetailed=#{serviceDetailed},updateTime=#{updateTime},
		authentiCationStatus=#{authentiCationStatus},welfareStatus=#{welfareStatus},
		termOfValidity=#{termOfValidity}
		where welfareStatus!=3 and
		userId=#{userId} and id=#{id}
	</update>

	<!-- 公开列表分页总数 -->

	<select id="getmrpListNo" resultType="long">
		select count(*) from menuandrenovationandpestcontrol where
		welfareStatus=1 and releaseType=#{releaseType}
		and userId in (select userId
		from t_user_realname where detailed like
		#{detailed})
		<if test="releaseTitle!=null and releaseTitle.trim()!=''">and releaseTitle =#{releaseTitle}   </if>
	</select>

	<!-- 公开列表分页概览 -->
	<select id="getmrpList"
		resultType="com.dian.mmall.pojo.meichongguanggao.MenuAndRenovationAndPestControl">
		select
		id,userId,servicFrequenc,releaseTitle,pictureUrl,startPrice,serviceDetailed,termOfValidity
		from menuandrenovationandpestcontrol where welfareStatus=1 and
		releaseType=#{releaseType}
		and userId in (select userId
		from
		t_user_realname where detailed like
		#{detailed})
		<if test="releaseTitle!=null and releaseTitle.trim()!=''">and releaseTitle = #{releaseTitle}   </if>
		order by updateTime desc
		limit #{pageLength}, #{pageSize}
	</select>
	<!-- 查看该实名城市下发布过服务的标题 -->
	<select id="getReleaseTitleList" resultType="String">
		select DISTINCT releaseTitle from menuandrenovationandpestcontrol
		where welfareStatus=1 and releaseType=#{releaseType}
		and userId in (select userId
		from t_user_realname where detailed like
		#{detailed})
		<if test="releaseTitle!=null and releaseTitle.trim()!=''">and releaseTitle like #{releaseTitle}   </if>
	</select>
	<!-- 查看详情 -->
	<select id="getMrpDetails"
		resultType="com.dian.mmall.pojo.meichongguanggao.MenuAndRenovationAndPestControl">
		select id,userId,evaluateid,servicFrequenc,releaseType,
		releaseTitle,serviceIntroduction,remarks,
		pictureUrl,startPrice,
		consigneeName,createTime,serviceDetailed,termOfValidity
		from
		menuandrenovationandpestcontrol where welfareStatus=1 and id=#{id}

	</select>
	<!-- 查看详情 -->
	<select id="adminGetMraall"
		resultType="com.dian.mmall.pojo.meichongguanggao.MenuAndRenovationAndPestControl">
		select id,userId,evaluateid,servicFrequenc,releaseType,
		releaseTitle,serviceIntroduction,remarks,termOfValidity,
		pictureUrl,startPrice,
		consigneeName,createTime,serviceDetailed,welfareStatus
		from
		menuandrenovationandpestcontrol where welfareStatus=1 and
		userId=#{userId}

	</select>




	<!-- 公开列表分页概览 -->
	<select id="getMrpBunner"
		resultType="com.dian.mmall.pojo.meichongguanggao.MenuAndRenovationAndPestControl">
		select
		id,servicFrequenc,releaseTitle,pictureUrl,startPrice,serviceDetailed
		from menuandrenovationandpestcontrol
		where welfareStatus=1 and id=#{id}
	</select>
</mapper>