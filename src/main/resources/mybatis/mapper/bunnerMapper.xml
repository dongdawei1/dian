<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dian.mmall.dao.BunnerMapper">

	<select id="getBunnerList"
		resultType="com.dian.mmall.pojo.banner.DibuBunner">
		select tableName,tableId,url,detailed
		,dibuBunnerbiaoti,introduceList,releaseType from dibubunner
		where
		role=#{role} and bunnerType=#{bunnerType} and bunnerStatus=1 and
		startTime &lt;= #{date} and endTime &gt;= #{date}
		<if test="permissionid!=null">and permissionid=#{permissionid}  </if>
		<if test="detailed!=null">and detailed like #{detailed}  </if>


		order by updateTime desc limit 2

	</select>


	<select id="getguanggaocount" resultType="int">
		select count(*) from
		dibubunner
		where permissionid=#{permissionid} and tableId=#{tableId}
		and bunnerStatus
		in(1,0)
	</select>
	<!-- 创建广告前查询时间段有无冲突 -->
	<select id="getisguanggaocount" resultType="int">
		select count(*) from dibubunner
		where bunnerType=#{bunnerType} and
		bunnerStatus in(0,1) and moren=#{moren} 
		and ( endTime &gt;= #{endTime} or endTime &gt;= #{startTime})
		<if test="fanwei==1 or fanwei==3"> and detailed like #{detailed}</if>
		<if test="fanwei==2 or fanwei==4"> and detailed= #{detailed}</if>
	</select>

	<!-- 创建广告 -->

	<insert id="creatdu">
		insert into dibubunner (
		userId,moren,updateTime,createTime,fanwei,
		url,endTime,startTime,
		detailed,tableId,
		permissionid,bunnerType,tablenameid,
		dibuBunnerbiaoti,
		imgUrl,examineName,bunnerStatus,createId,releaseType
		) values (
		#{userId},
		#{moren}, #{updateTime}, #{createTime},#{fanwei},
		#{url},#{endTime},
		#{startTime},
		#{detailed},#{tableId},#{permissionid},
		#{bunnerType},#{tablenameid},#{dibuBunnerbiaoti},
		#{imgUrl},#{examineName},#{bunnerStatus},#{createId},#{releaseType}
		)
	</insert><!-- countNum -->




	<!-- 管理查询广告 -->
	<select id="getisguanggao"
		resultType="com.dian.mmall.pojo.banner.DibuBunner">
		select id, startTime,endTime,userId,examineName,moren,detailed,
		bunnerStatus ,bunnerType ,releaseType from dibubunner
		where bunnerType=#{bunnerType} and bunnerStatus in(0,1) and
		moren=#{moren}
		<if test="fanwei==1 or fanwei==3"> and detailed like #{detailed}</if>
		<if test="fanwei==2 or fanwei==4"> and detailed= #{detailed}</if>
	</select>



</mapper>